# 画布操作

<cite>
**本文档中引用的文件**
- [index.vue](file://src/views/index.vue)
- [Toolbar.vue](file://demo/Toolbar/src/components/Toolbar.vue)
- [g6-editor.md](file://doc/v1/g6-editor.md)
</cite>

## 目录
1. [简介](#简介)
2. [画布核心操作功能](#画布核心操作功能)
3. [组合与取消组合功能逻辑](#组合与取消组合功能逻辑)
4. [多选模式交互行为](#多选模式交互行为)
5. [层级调整机制](#层级调整机制)
6. [命令注册与执行流程](#命令注册与执行流程)

## 简介
本文件全面文档化基于 G6 Editor 构建的图形化编辑器中画布的核心操作功能。重点涵盖缩放、平移、实际大小、适应页面、清除画布等基础操作，以及组合、取消组合、多选模式和层级调整等高级功能。通过分析工具栏指令绑定机制与 G6 Editor 内置命令的交互流程，深入解析各功能的技术实现路径。

## 画布核心操作功能

画布的核心操作功能通过工具栏中的 `data-command` 指令与 G6 Editor 内置命令进行绑定实现。这些操作包括放大（zoomIn）、缩小（zoomOut）、实际大小（autoZoom）、适应页面（resetZoom）和清除画布（clear）等。

在 `index.vue` 和 `Toolbar.vue` 文件中，工具栏按钮通过 `data-command` 属性直接关联 G6 Editor 的预定义命令。例如，`<i data-command="zoomIn" class="command fa fa-search-plus" title="放大"></i>` 绑定了放大功能，用户点击该按钮时，G6 Editor 会自动执行对应的 `zoomIn` 命令。

此外，文档 `g6-editor.md` 提供了默认快捷键映射，如 `Ctrl + =` 对应 `zoomIn`，`Ctrl + -` 对应 `zoomOut`，`Ctrl + 0` 对应 `resetZoom`，实现了键盘与界面操作的统一。

**Section sources**
- [index.vue](file://src/views/index.vue#L10-L25)
- [Toolbar.vue](file://demo/Toolbar/src/components/Toolbar.vue#L6-L16)
- [g6-editor.md](file://doc/v1/g6-editor.md#L920-L945)

## 组合与取消组合功能逻辑

组合（addGroup）与取消组合（unGroup）功能用于将多个节点合并为一个群组或将其拆分。此功能在多选场景下尤为关键，允许用户对一组节点进行统一操作。

在工具栏和右键菜单中均提供了组合与取消组合的操作入口。当用户选择多个节点后，点击“组合”按钮（`data-command="addGroup"`），G6 Editor 会创建一个新的群组节点，并将所选节点作为其子节点。反之，“取消组合”命令（`data-command="unGroup"`）则会移除群组结构，恢复原始节点的独立状态。

右键菜单根据当前选择状态动态显示可用命令。在多选状态下，右键菜单会显示“组合”选项；而在群组被选中时，则显示“取消组合”选项，确保操作上下文的准确性。

**Section sources**
- [index.vue](file://src/views/index.vue#L20-L22)
- [index.vue](file://src/views/index.vue#L233-L281)
- [g6-editor.md](file://doc/v1/g6-editor.md#L286-L319)

## 多选模式交互行为

多选模式通过工具栏中的 `data-command="multiSelect"` 指令启用。启用后，用户可通过鼠标框选方式同时选择多个画布元素。

在 `index.vue` 中，`<i data-command="multiSelect" class="command fa fa fa-crop" title="多选"></i>` 提供了多选功能的可视化入口。一旦激活多选模式，用户拖拽鼠标形成的矩形区域内的所有节点和边都会被选中。

多选状态不仅影响视觉反馈，还决定了右键菜单中可执行的操作。在多选状态下，右键菜单仅显示“复制”、“粘贴”和“组合”等适用于多个对象的命令，屏蔽了如“属性编辑”等仅适用于单个对象的功能，从而提升操作的安全性与合理性。

**Section sources**
- [index.vue](file://src/views/index.vue#L22)
- [index.vue](file://src/views/index.vue#L233-L281)

## 层级调整机制

层级调整功能通过 `toFront`（提升层级）和 `toBack`（下降层级）命令实现，用于控制节点在渲染栈中的顺序，解决视觉遮挡问题。

当多个节点发生重叠时，后添加的节点默认位于上层。通过执行 `toFront` 命令，可将选定节点移至最顶层；执行 `toBack` 命令则将其移至最底层。这一机制基于 Z 轴排序原理，直接影响 SVG 或 Canvas 的绘制顺序。

在工具栏中，`<i data-command="toFront" class="command fa fa-arrow-up" title="提升层级"></i>` 和 `<i data-command="toBack" class="command fa fa-arrow-down" title="下降层级"></i>` 提供了直观的操作方式，帮助用户调整复杂图示中的节点可见性。

**Section sources**
- [index.vue](file://src/views/index.vue#L18-L19)
- [Toolbar.vue](file://demo/Toolbar/src/components/Toolbar.vue#L10-L11)

## 命令注册与执行流程

G6 Editor 的命令系统采用注册-执行模式。内置命令如 `zoomIn`、`delete` 等由框架预定义，而自定义命令（如 `save`）可通过 `Command.registerCommand()` 方法注册。

在 `index.vue` 中，`initG6Editor` 方法内调用了 `Command.registerCommand("save", {...})`，注册了一个自定义保存命令。该命令包含 `execute`（正向执行）和 `back`（反向撤销）方法，并可通过 `shortcutCodes` 设置快捷键。

命令的执行由 G6 Editor 统一调度。当用户触发某个 `data-command` 时，框架会查找已注册的对应命令并执行其 `execute` 方法。若命令配置了 `queue: true`，则该操作将进入撤销队列，支持后续的撤销（undo）与重做（redo）操作。

此外，快捷键的启用需在初始化 `Flow` 实例时显式开启，如 `shortcut: { save: true }`，否则即使注册了快捷键也不会生效。

**Section sources**
- [index.vue](file://src/views/index.vue#L274-L324)
- [g6-editor.md](file://doc/v1/g6-editor.md#L852-L919)
- [g6-editor.md](file://doc/v1/g6-editor.md#L417-L446)