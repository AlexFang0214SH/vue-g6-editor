# 边操作

<cite>
**本文档中引用的文件**  
- [index.vue](file://src/views/index.vue)
- [mixin.js](file://src/views/mixin.js)
- [g6-editor.md](file://doc/v1/g6-editor.md)
</cite>

## 目录
1. [引言](#引言)
2. [边的创建与默认样式初始化](#边的创建与默认样式初始化)
3. [边属性编辑机制](#边属性编辑机制)
4. [边形态切换实现原理](#边形态切换实现原理)
5. [边数据模型与绑定逻辑](#边数据模型与绑定逻辑)
6. [边删除操作触发路径](#边删除操作触发路径)
7. [结论](#结论)

## 引言
本文档系统性地描述了在 `vue-g6-editor` 项目中，边的创建、属性编辑与形态切换功能的技术实现。重点说明用户通过鼠标连接节点自动生成边的技术流程，以及边默认样式（`flow-polyline`）的初始化配置。详细文档化边属性栏中边文本和边形状（折线、圆角折线、曲线）的动态更新机制，并解释如何通过 G6 图实例的 `edge()` 方法在 `afteritemselected` 事件中实时修改边的 `shape` 属性。同时提供边数据模型（`label`、`shape`）的字段定义与绑定逻辑，展示在 `detailpannel` 中基于 Vue 表单的双向数据绑定实现方式，并涵盖边删除操作在右键菜单和工具栏中的触发路径。

**Section sources**
- [index.vue](file://src/views/index.vue#L1-L515)
- [mixin.js](file://src/views/mixin.js#L0-L32)

## 边的创建与默认样式初始化
在 `vue-g6-editor` 中，边的创建是通过用户在画布上拖拽节点锚点完成的。当用户从一个节点的输出锚点拖动至另一个节点的输入锚点时，G6Editor 会自动创建一条边并将其添加到图中。

边的默认样式在初始化阶段通过 `flow.getGraph().edge()` 方法进行全局配置。在 `index.vue` 的 `initG6Editor` 方法中，调用如下代码设置所有新创建边的默认形状为 `flow-polyline`：

```javascript
flow.getGraph().edge({
  shape: "flow-polyline"
});
```

该配置确保了所有由用户操作生成的新边均采用“流程图折线”样式，从而保持图表风格的一致性。

**Section sources**
- [index.vue](file://src/views/index.vue#L370-L376)

## 边属性编辑机制
边的属性编辑功能通过右侧的 `detailpannel`（属性栏）实现。当用户选中一条边时，系统会触发 `afteritemselected` 事件，该事件监听器负责将当前选中边的数据模型同步到 Vue 组件的响应式数据 `edgeAttributeForm` 中。

具体流程如下：
1. 监听 `currentPage.on("afteritemselected")` 事件；
2. 判断选中项是否为边（`ev.item.isEdge`）；
3. 将边模型中的 `label` 和 `shape` 字段赋值给 `edgeAttributeForm` 对应属性；
4. 在模板中使用 `v-model` 实现表单控件与数据的双向绑定。

当用户在输入框中修改边文本后，`@change="saveEdgeAttribute"` 事件被触发，执行保存逻辑。

**Section sources**
- [index.vue](file://src/views/index.vue#L418-L428)
- [mixin.js](file://src/views/mixin.js#L13-L25)

## 边形态切换实现原理
边的形态切换功能通过下拉选择器实现，支持三种预设样式：`flow-polyline`（折线）、`flow-polyline-round`（圆角折线）和 `flow-smooth`（曲线）。这些选项在 `detailpannel` 的 `<el-select>` 组件中定义。

关键实现逻辑位于 `mixin.js` 的 `saveEdgeAttribute` 方法中。该方法通过 `editor.executeCommand()` 执行一个命令事务，在事务中调用 `page.update(selectedItemId, { shape: ... })` 来更新当前选中边的 `shape` 属性。

此外，在 `afteritemselected` 事件处理函数中，存在一段特殊逻辑：

```javascript
if (ev.item.isEdge) {
  ev.item.graph.edge({
    shape: "flow-polyline-round"
  });
  // ...
}
```

此代码会在每次选中边时临时更改图的默认边样式，但实际应用中应以 `page.update()` 更新单个边属性为主，避免影响全局配置。

**Section sources**
- [index.vue](file://src/views/index.vue#L424-L426)
- [mixin.js](file://src/views/mixin.js#L13-L25)

## 边数据模型与绑定逻辑
边的数据模型主要包含两个核心字段：

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `label` | String | 边上显示的文本内容 |
| `shape` | String | 边的几何形状类型，取值为 `flow-polyline`、`flow-polyline-round` 或 `flow-smooth` |

这些字段通过 Vue 的响应式系统与 `detailpannel` 中的表单元素实现双向数据绑定：

- `<el-input v-model="edgeAttributeForm.label">` 绑定边文本；
- `<el-select v-model="edgeAttributeForm.shape">` 绑定边形状。

当用户更改表单值时，`@change` 事件触发 `saveEdgeAttribute` 方法，最终调用 `page.update()` 将变更持久化到图数据中，实现视图与模型的同步。

**Section sources**
- [index.vue](file://src/views/index.vue#L140-L150)
- [mixin.js](file://src/views/mixin.js#L13-L25)

## 边删除操作触发路径
边的删除操作可通过两种方式触发：

### 工具栏删除按钮
在顶部工具栏中，存在一个带有 `data-command="delete"` 的图标按钮。点击该按钮时，G6Editor 会识别当前选中的元素类型（包括边），并执行删除命令。

```html
<i data-command="delete" class="command fa fa-trash-o" title="删除"></i>
```

### 右键菜单删除选项
当用户右键点击一条已选中的边时，右键菜单会显示对应状态下的操作项。根据 `contextmenu` 容器中的结构，当边处于选中状态（`data-status="edge-selected"`）时，菜单仅显示“删除”按钮。

```html
<div data-status="edge-selected" class="menu">
  <el-button data-command="delete" class="command">删除</el-button>
</div>
```

两种方式均通过 G6Editor 内部的 `delete` 命令实现元素移除，并触发 `afterdelete` 事件通知系统更新状态。

**Section sources**
- [index.vue](file://src/views/index.vue#L206-L233)
- [index.vue](file://src/views/index.vue#L7-L25)

## 结论
本系统通过 G6Editor 提供的强大图形编辑能力，结合 Vue 的响应式数据绑定机制，实现了完整的边操作功能体系。从边的创建、样式初始化、属性编辑、形态切换到删除操作，各环节均通过清晰的事件驱动架构和组件化设计完成。边的 `label` 和 `shape` 属性通过 `detailpannel` 实现可视化编辑，并借助 `page.update()` 方法实现动态更新。删除功能则通过工具栏和右键菜单提供多路径操作入口，提升了用户体验的灵活性与便捷性。