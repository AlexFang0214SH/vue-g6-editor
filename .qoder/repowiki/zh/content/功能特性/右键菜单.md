# 右键菜单

<cite>
**本文档引用文件**  
- [index.vue](file://src/views/index.vue)
- [g6-editor.md](file://doc/v1/g6-editor.md)
- [index.less](file://src/views/index.less)
</cite>

## 目录
1. [右键菜单上下文敏感行为](#右键菜单上下文敏感行为)
2. [DOM结构与状态系统联动机制](#dom结构与状态系统联动机制)
3. [命令绑定与执行机制](#命令绑定与执行机制)
4. [组合与取消组合的菜单可见性逻辑](#组合与取消组合的菜单可见性逻辑)
5. [右键菜单组件挂载与集成](#右键菜单组件挂载与集成)

## 右键菜单上下文敏感行为

右键菜单根据当前选中对象的类型动态显示不同的操作选项。当用户在画布上右键点击时，系统会根据当前选中对象的类型（节点、边、群组、画布或多个对象）来决定显示哪个菜单项。具体行为如下：

- **节点选中**：显示复制、粘贴、删除操作
- **边选中**：仅显示删除操作
- **群组选中**：显示复制、粘贴、取消组合和删除操作
- **画布选中**：显示撤销和重做操作
- **多选场景**：显示复制、粘贴和组合操作

这种上下文敏感的行为确保了用户只能执行与当前选中对象类型相关的操作，提高了用户体验和操作的安全性。

**Section sources**
- [index.vue](file://src/views/index.vue#L206-L233)
- [g6-editor.md](file://doc/v1/g6-editor.md#L286-L319)

## DOM结构与状态系统联动机制

右键菜单的DOM结构通过`data-status`属性与G6 Editor的状态系统进行联动。每个菜单容器都包含一个`data-status`属性，该属性的值对应于特定的编辑器状态。当编辑器状态发生变化时，系统会自动匹配相应的`data-status`值并显示对应的菜单。

例如，当用户选中一个节点时，编辑器状态变为`node-selected`，系统会查找`data-status="node-selected"`的菜单容器并将其显示，同时隐藏其他不匹配状态的菜单容器。这种机制确保了菜单项的精准匹配和正确显示。

**Section sources**
- [index.vue](file://src/views/index.vue#L206-L233)
- [g6-editor.md](file://doc/v1/g6-editor.md#L286-L319)

## 命令绑定与执行机制

右键菜单中的操作通过`data-command`属性绑定到G6 Editor的内置命令。每个菜单项都有一个`data-command`属性，该属性的值对应于一个预定义的命令。当用户点击某个菜单项时，系统会触发相应的命令执行。

例如，`data-command="copy"`绑定到复制命令，`data-command="delete"`绑定到删除命令。这些命令由G6 Editor的核心系统管理，确保了操作的一致性和可靠性。通过这种方式，开发者可以轻松地扩展和自定义菜单功能，而无需深入了解底层实现细节。

**Section sources**
- [index.vue](file://src/views/index.vue#L206-L233)
- [g6-editor.md](file://doc/v1/g6-editor.md#L286-L319)

## 组合与取消组合的菜单可见性逻辑

在群组场景下，"取消组合"（unGroup）菜单项仅在用户选中一个已组合的对象时显示。当用户右键点击一个群组时，系统会检测到`group-selected`状态，并显示包含"取消组合"选项的菜单。这允许用户将群组分解为其组成元素。

在多选场景下，"组合"（addGroup）菜单项仅在用户选中多个独立对象时显示。当用户同时选中两个或更多对象并右键点击时，系统会检测到`multi-selected`状态，并显示包含"组合"选项的菜单。这允许用户将多个对象合并为一个群组，便于统一管理和操作。

**Section sources**
- [index.vue](file://src/views/index.vue#L206-L233)
- [g6-editor.md](file://doc/v1/g6-editor.md#L286-L319)

## 右键菜单组件挂载与集成

右键菜单组件通过`G6Editor.Contextmenu`类进行实例化和挂载。在应用初始化过程中，创建一个`Contextmenu`实例，并将其容器设置为DOM中id为`contextmenu`的元素。然后，将该实例添加到G6 Editor的组件管理系统中，完成集成。

具体实现代码如下：
```javascript
const contextmenu = new G6Editor.Contextmenu({
  container: "contextmenu"
});
editor.add(contextmenu);
```

此外，为了改善用户体验，需要在CSS中将右键菜单的初始显示状态设置为`display: none`，以避免菜单在页面加载时意外显示。只有当用户实际执行右键操作时，菜单才会被动态显示。

**Section sources**
- [index.vue](file://src/views/index.vue#L206-L233)
- [g6-editor.md](file://doc/v1/g6-editor.md#L286-L319)
- [index.less](file://src/views/index.less#L124-L146)