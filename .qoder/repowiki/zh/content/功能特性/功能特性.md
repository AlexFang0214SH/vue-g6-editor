<cite>
**本文档引用文件**
- [index.vue](file://src/views/index.vue)
- [mixin.js](file://src/views/mixin.js)
- [g6-editor.md](file://doc/v1/g6-editor.md)
</cite>

# 功能特性

## 节点操作

### 拖拽创建节点
系统支持通过拖拽方式创建多种类型的节点。用户可以从元素面板中拖拽节点到画布上进行创建。支持的节点类型包括：
- **开始节点**：圆形节点，用于表示流程的起点
- **常规节点**：矩形节点，用于表示流程中的常规操作
- **条件节点**：菱形节点，用于表示流程中的条件判断
- **结束节点**：圆形节点，用于表示流程的终点

在实现上，通过HTML元素的`data-*`属性定义节点的类型、形状、大小、标签和颜色等属性，这些属性在拖拽时会被自动应用到新创建的节点上。

**使用场景**：在设计业务流程时，用户可以通过拖拽快速创建流程的各个阶段，从开始节点到结束节点，中间穿插常规操作和条件判断。

**最佳实践**：建议保持节点类型的统一性，确保相同类型的节点使用相同的视觉样式，以提高流程图的可读性。

**Section sources**
- [index.vue](file://src/views/index.vue#L49-L96)

### 节点数量限制
系统实现了对特定类型节点的数量限制。根据业务需求，画布上只能存在一个开始节点和一个结束节点。当用户尝试添加第二个开始或结束节点时，系统会自动删除新添加的节点，并通过消息提示用户。

**技术实现**：通过监听`afterchange`事件，当检测到添加新节点的操作时，检查节点类型。如果发现重复的开始或结束节点，则调用`remove`方法删除新节点。

**使用场景**：确保流程图的逻辑完整性，防止用户创建不符合业务规则的流程结构。

**最佳实践**：在创建复杂流程时，先确定开始和结束节点，然后再添加中间的流程步骤。

**Section sources**
- [index.vue](file://src/views/index.vue#L366-L402)

## 边操作

### 连接与删除
系统支持创建和删除节点之间的连接边。用户可以通过拖拽节点的连接点来创建新的边，也可以通过选择边后使用删除功能来移除连接。

**右键菜单支持**：当用户选择一条边时，右键菜单会显示"删除"选项，允许用户快速删除选中的边。

**技术实现**：通过G6Editor的内置命令系统，使用`delete`命令来删除选中的边。

**使用场景**：在调整流程逻辑时，需要重新连接节点或移除不必要的连接。

**最佳实践**：在删除边之前，确认该连接不再需要，以免破坏流程的完整性。

**Section sources**
- [index.vue](file://src/views/index.vue#L206-L233)

### 重连
系统支持边的重连操作。用户可以通过拖拽边的端点来改变其连接的目标节点。

**技术实现**：G6Editor的图形引擎原生支持边的重连功能，无需额外的自定义实现。

**使用场景**：当需要调整流程的执行顺序或条件分支时，可以通过重连快速修改流程结构。

**最佳实践**：在进行重连操作时，注意保持流程的逻辑正确性，避免创建循环引用或逻辑矛盾。

## 画布操作

### 缩放与平移
系统提供了完整的画布导航功能，包括缩放和平移操作。

**工具栏控制**：
- **放大**：点击放大图标或使用`Ctrl + =`快捷键
- **缩小**：点击缩小图标或使用`Ctrl + -`快捷键
- **实际大小**：点击实际大小图标或使用`Ctrl + 0`快捷键
- **适应页面**：点击适应页面图标，自动调整视图以显示整个画布内容

**技术实现**：通过G6Editor的内置命令`zoomIn`、`zoomOut`、`autoZoom`和`resetZoom`实现。

**使用场景**：在处理大型流程图时，需要放大查看细节或缩小查看整体结构。

**最佳实践**：建议在编辑细节时使用放大功能，在审查整体流程时使用适应页面功能。

**Section sources**
- [index.vue](file://src/views/index.vue#L23-L51)

### 网格对齐
系统提供了网格对齐辅助功能，帮助用户精确布局节点。

**功能特性**：
- **网格显示**：画布上显示网格线，作为布局参考
- **对齐辅助**：移动节点时会自动吸附到最近的网格点
- **全方位对齐**：支持水平、垂直和全方位对齐

**技术实现**：通过Flow配置中的`align`和`grid`选项启用对齐功能。`align.line`配置对齐线的颜色和粗细，`align.item`和`align.grid`分别控制元素对齐和网格对齐的开关。

**使用场景**：在创建需要精确对齐的流程图时，如组织架构图或网络拓扑图。

**最佳实践**：建议在创建新流程时开启网格对齐，以确保节点布局的整齐美观。

**Section sources**
- [index.vue](file://src/views/index.vue#L320-L370)

### 组合与解组
系统支持将多个节点组合成一个组，或将组分解为独立的节点。

**功能特性**：
- **组合**：选择多个节点后，可以将它们组合成一个逻辑单元
- **解组**：将已组合的节点组分解为独立的节点

**右键菜单支持**：当选择多个节点或一个组时，右键菜单会显示相应的组合或解组选项。

**技术实现**：通过G6Editor的`addGroup`和`unGroup`命令实现。

**使用场景**：在管理复杂流程时，可以将相关的流程步骤组合在一起，提高流程图的可读性和可管理性。

**最佳实践**：建议将功能相关的节点组合在一起，并为组添加有意义的标签。

**Section sources**
- [index.vue](file://src/views/index.vue#L206-L233)

## 属性编辑

### 动态表单更新
系统提供了动态属性编辑功能，允许用户修改选中元素的属性。

**技术实现**：
- **节点属性**：包括标签、宽度、高度和颜色等
- **边属性**：包括标签和形状（折线、圆角折线、曲线）
- **数据绑定**：通过Vue的双向数据绑定，将表单值与节点数据模型同步
- **更新机制**：使用`executeCommand`方法执行更新操作，确保操作可撤销

**交互流程**：
1. 用户选择一个节点或边
2. 对应的属性栏自动显示
3. 用户修改表单值
4. 通过`@change`事件触发保存方法
5. 调用`page.update`方法更新元素属性

**使用场景**：在设计流程时，需要调整节点的外观或边的样式以满足特定的可视化需求。

**最佳实践**：建议使用一致的颜色方案和尺寸标准，以保持流程图的专业外观。

**Section sources**
- [mixin.js](file://src/views/mixin.js#L0-L31)
- [index.vue](file://src/views/index.vue#L124-L150)

## 右键菜单上下文操作

### 上下文敏感菜单
系统实现了上下文敏感的右键菜单，根据当前选择的对象类型显示不同的操作选项。

**菜单配置**：
- **节点选中**：显示复制、粘贴、删除选项
- **边选中**：显示删除选项
- **组选中**：显示复制、粘贴、取消组合、删除选项
- **画布选中**：显示撤销、重做选项
- **多选**：显示复制、粘贴、组合选项

**技术实现**：通过HTML中的`data-status`属性定义不同状态下的菜单内容，G6Editor会根据当前状态自动显示相应的菜单。

**使用场景**：在编辑流程时，通过右键菜单快速访问常用操作，提高工作效率。

**最佳实践**：建议熟悉不同上下文下的可用操作，以充分利用右键菜单的便利性。

**Section sources**
- [index.vue](file://src/views/index.vue#L206-L233)

## 撤销/重做栈管理

### 命令模式实现
系统通过G6Editor的命令系统实现了完善的撤销/重做功能。

**技术实现**：
- **命令注册**：所有可撤销的操作都通过命令模式执行
- **命令队列**：执行的命令被记录在队列中，支持撤销和重做
- **快捷键支持**：`Ctrl + Z`用于撤销，`Ctrl + Shift + Z`用于重做

**特殊命令**：`save`命令被设置为`queue: false`，即不进入命令队列，因为保存操作通常不需要被撤销。

**使用场景**：在编辑过程中犯错时，可以快速撤销到之前的状态。

**最佳实践**：建议在进行重大修改前，先保存当前状态，以便在需要时可以恢复。

**Section sources**
- [index.vue](file://src/views/index.vue#L274-L324)

## 数据持久化机制

### localStorage自动保存
系统实现了自动保存功能，将流程数据持久化到浏览器的localStorage中。

**技术实现**：
- **保存命令**：注册自定义的`save`命令
- **数据存储**：调用`editor.getCurrentPage().save()`获取当前画布数据，然后使用`localStorage.setItem`存储
- **用户反馈**：保存成功后显示成功消息提示

**使用场景**：防止因意外关闭浏览器而导致的数据丢失。

**最佳实践**：建议定期手动保存，特别是在完成重要修改后。

**Section sources**
- [index.vue](file://src/views/index.vue#L274-L324)

### JSON文件导入导出
系统支持将流程数据导出为JSON文件，以及从JSON文件导入数据。

**导出功能**：
- **实现**：调用`save()`方法获取数据，创建Blob对象，生成下载链接
- **文件格式**：JSON格式，文件名为"数据.json"

**导入功能**：
- **实现**：创建文件输入元素，监听文件选择事件，读取文件内容并调用`read()`方法加载数据

**使用场景**：在不同设备间共享流程设计，或进行版本备份。

**最佳实践**：建议为导出的文件添加有意义的文件名和版本信息。

**Section sources**
- [index.vue](file://src/views/index.vue#L464-L513)

### 画布内容导出为PNG图片
系统支持将画布内容导出为图片格式，包括PNG和JPG。

**技术实现**：
- **PNG导出**：直接调用`saveImage()`方法获取canvas，转换为data URL
- **JPG导出**：由于JPG不支持透明背景，需要创建新的canvas，填充白色背景后再导出
- **下载机制**：创建临时下载链接，触发浏览器下载

**使用场景**：将流程图分享给没有编辑器的同事，或嵌入到文档中。

**最佳实践**：对于需要透明背景的场合使用PNG格式，对于普通分享使用JPG格式。

**Section sources**
- [index.vue](file://src/views/index.vue#L434-L466)

## 缩略图功能

### 大图导航体验
系统通过缩略图组件提升了大图导航体验。

**技术实现**：
- **组件初始化**：创建`G6Editor.Minimap`实例，指定容器和尺寸
- **双图联动**：主画布和缩略图同步显示，用户可以在缩略图上拖拽视窗来快速定位

**配置参数**：
- **容器**：指定为`minimap`的HTML元素
- **尺寸**：宽度根据右侧面板计算，高度固定为200px

**使用场景**：在处理包含大量节点的复杂流程图时，快速定位到特定区域。

**最佳实践**：建议在创建大型流程图时始终开启缩略图功能，以提高导航效率。

**Section sources**
- [index.vue](file://src/views/index.vue#L320-L370)