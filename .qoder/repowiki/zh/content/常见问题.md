# 常见问题

<cite>
**本文档引用文件**  
- [g6-editor.md](file://doc/v1/g6-editor.md)
- [index.vue](file://src/views/index.vue)
- [mixin.js](file://src/views/mixin.js)
- [App.vue](file://src/App.vue)
- [package.json](file://package.json)
- [vue.config.js](file://vue.config.js)
</cite>

## 目录
1. [节点拖拽无反应](#节点拖拽无反应)
2. [属性面板不更新](#属性面板不更新)
3. [保存数据丢失](#保存数据丢失)
4. [工具栏按钮无效](#工具栏按钮无效)
5. [Vue响应式系统兼容性问题](#vue响应式系统兼容性问题)
6. [部署相关问题](#部署相关问题)
7. [调试工具推荐](#调试工具推荐)
8. [版本升级迁移建议](#版本升级迁移建议)
9. [官方文档与Issue提交](#官方文档与issue提交)

## 节点拖拽无反应

### 根本原因
1. 元素面板中拖拽元素的 `class` 名称未正确设置为 `getItem`
2. 元素图片未设置 `draggable="false"`
3. 画布容器ID未正确设置为 `page`
4. 未正确初始化 `Itempannel` 组件

### 解决方案
1. 确保元素面板中每个可拖拽元素的 `class` 包含 `getItem`
2. 为所有元素图片添加 `draggable="false"` 属性
3. 确认画布容器的ID为 `page`
4. 在初始化代码中正确创建 `Itempannel` 实例：

```javascript
const itempannel = new G6Editor.Itempannel({
  container: "itempannel"
});
editor.add(itempannel);
```

**Section sources**
- [g6-editor.md](file://doc/v1/g6-editor.md#L89-L165)
- [index.vue](file://src/views/index.vue#L233-L324)

## 属性面板不更新

### 根本原因
1. 未正确监听 `afteritemselected` 事件
2. Vue组件状态更新未触发响应式更新
3. 数据绑定路径错误

### 解决方案
1. 确保正确监听选择事件并更新表单数据：

```javascript
currentPage.on("afteritemselected", (ev) => {
  const selectedItemDataModel = ev.item.model;
  if (ev.item.isNode) {
    this.nodeAttributeForm.label = selectedItemDataModel.label;
    this.nodeAttributeForm.width = selectedItemDataModel.size.split("*")[0];
    this.nodeAttributeForm.height = selectedItemDataModel.size.split("*")[1];
    this.nodeAttributeForm.color = selectedItemDataModel.color;
  }
});
```

2. 使用 `Vue.set` 确保响应式更新：

```javascript
this.$set(this.nodeAttributeForm, 'label', newValue);
```

**Section sources**
- [g6-editor.md](file://doc/v1/g6-editor.md#L199-L221)
- [index.vue](file://src/views/index.vue#L366-L402)
- [mixin.js](file://src/views/mixin.js#L3-L32)

## 保存数据丢失

### 根本原因
1. 未正确调用 `save()` 方法
2. 数据未持久化存储
3. 异步操作未正确处理

### 解决方案
1. 确保正确注册保存命令并执行：

```javascript
Command.registerCommand("save", {
  queue: false,
  execute(editor) {
    let needSaveData = editor.getCurrentPage().save();
    localStorage.setItem("flowData", JSON.stringify(needSaveData));
    _this.$message.success("数据已保存");
  },
  shortcutCodes: [["metaKey", "s"], ["ctrlKey", "s"]]
});
```

2. 使用浏览器存储机制持久化数据：

```javascript
// 保存到localStorage
localStorage.setItem("flowData", JSON.stringify(data));

// 从localStorage读取
let stringData = localStorage.getItem("flowData");
```

**Section sources**
- [index.vue](file://src/views/index.vue#L274-L324)
- [index.vue](file://src/views/index.vue#L403-L420)

## 工具栏按钮无效

### 根本原因
1. 工具栏元素缺少必要属性
2. 未正确初始化 `Toolbar` 组件
3. 命令未正确注册

### 解决方案
1. 确保工具栏按钮包含必要属性：

```html
<i data-command="save" class="command fa fa-floppy-o" title="保存"></i>
```

2. 正确初始化 `Toolbar` 组件：

```javascript
const toolbar = new G6Editor.Toolbar({
  container: "toolbar"
});
editor.add(toolbar);
```

3. 检查自定义命令是否正确注册

**Section sources**
- [g6-editor.md](file://doc/v1/g6-editor.md#L48-L61)
- [index.vue](file://src/views/index.vue#L320-L324)

## Vue响应式系统兼容性问题

### 常见场景
1. 直接修改对象属性无法触发视图更新
2. 数组操作未触发响应式更新
3. 深层嵌套对象更新问题

### 应对策略
1. 使用 `Vue.set` 强制响应式更新：

```javascript
// 错误方式
this.nodeAttributeForm.label = "new label";

// 正确方式
this.$set(this.nodeAttributeForm, 'label', 'new label');
```

2. 在G6编辑器回调中使用 `this.$nextTick`：

```javascript
this.$nextTick(() => {
  // DOM更新后执行
});
```

3. 使用 `this.$forceUpdate()` 强制组件重新渲染（谨慎使用）

**Section sources**
- [mixin.js](file://src/views/mixin.js#L3-L32)
- [index.vue](file://src/views/index.vue#L421-L440)

## 部署相关问题

### 跨域资源加载与CORS策略
1. 确保SVG资源支持跨域访问
2. 配置服务器CORS头信息
3. 使用相对路径或CDN资源

### 构建路径错误
1. 检查 `vue.config.js` 中的 `publicPath` 配置：

```javascript
module.exports = {
  publicPath: (function() {
    if (process.env.NODE_ENV === "demo") {
      return "https://blueju.github.io/vue-g6-editor/dist/";
    }
  })()
};
```

2. 确保静态资源路径正确
3. 检查构建输出目录结构

**Section sources**
- [vue.config.js](file://vue.config.js#L0-L6)
- [package.json](file://package.json#L0-L29)
- [index.vue](file://src/views/index.vue#L233-L281)

## 调试工具推荐

### Vue Devtools
1. 检查组件状态和数据流
2. 监控事件触发
3. 查看组件层级结构

### G6 API调试接口
1. 打印画布数据：

```javascript
console.log(editor.getCurrentPage().save());
```

2. 监听关键事件：

```javascript
currentPage.on("afteritemselected", (ev) => {
  console.log("打印所选对象属性", ev.item);
  console.log("打印所选对象数据模型", ev.item.model);
});
```

3. 使用 `window.editor` 全局变量进行调试

**Section sources**
- [index.vue](file://src/views/index.vue#L298-L306)
- [index.vue](file://src/views/index.vue#L398-L399)

## 版本升级迁移建议

### Breaking Changes处理
1. 仔细阅读官方升级指南
2. 备份现有代码和数据
3. 在测试环境中验证升级

### 迁移步骤
1. 更新 `package.json` 中的依赖版本
2. 检查API变更并更新调用方式
3. 测试所有核心功能
4. 逐步部署到生产环境

**Section sources**
- [package.json](file://package.json#L0-L29)
- [g6-editor.md](file://doc/v1/g6-editor.md#L0-L44)

## 官方文档与Issue提交

### 查阅官方文档
1. G6官方文档：https://www.yuque.com/antv/g6
2. g6-editor文档：https://github.com/blueju/vue-g6-editor
3. 参考示例代码和API说明

### 提交Issue的正确方式
1. 清晰描述问题现象
2. 提供复现步骤
3. 包含错误信息和截图
4. 说明环境信息（版本、浏览器等）
5. 访问 https://github.com/blueju/vue-g6-editor 提交问题

**Section sources**
- [g6-editor.md](file://doc/v1/g6-editor.md#L0-L44)
- [g6-editor.md](file://doc/v1/g6-editor.md#L487-L518)