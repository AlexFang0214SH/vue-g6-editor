# 技术栈与依赖

<cite>
**本文档引用文件**  
- [package.json](file://package.json)
- [babel.config.js](file://babel.config.js)
- [vue.config.js](file://vue.config.js)
- [src/main.js](file://src/main.js)
- [src/App.vue](file://src/App.vue)
- [src/views/index.vue](file://src/views/index.vue)
- [src/views/mixin.js](file://src/views/mixin.js)
- [src/views/index.less](file://src/views/index.less)
- [doc/v1/g6-editor.md](file://doc/v1/g6-editor.md)
</cite>

## 目录
1. [技术栈概览](#技术栈概览)  
2. [核心依赖分析](#核心依赖分析)  
   - [@antv/g6-editor 图编辑引擎](#antvg6-editor-图编辑引擎)  
   - [Vue 前端框架](#vue-前端框架)  
   - [Element UI 组件库](#element-ui-组件库)  
   - [Font Awesome 图标库](#font-awesome-图标库)  
   - [netflix-conductor-json-tree 数据结构转换](#netflix-conductor-json-tree-数据结构转换)  
3. [构建与配置](#构建与配置)  
   - [package.json 脚本与依赖](#packagejson-脚本与依赖)  
   - [babel.config.js 配置](#babelconfigjs-配置)  
   - [vue.config.js 配置](#vueconfigjs-配置)  
4. [样式与工程化](#样式与工程化)  
   - [Less 样式处理](#less-样式处理)  
   - [Vue CLI 工具链支持](#vue-cli-工具链支持)  
5. [集成方式与调用位置](#集成方式与调用位置)  
6. [升级与定制建议](#升级与定制建议)  
7. [潜在风险与兼容性](#潜在风险与兼容性)

## 技术栈概览

本项目 `vue-g6-editor` 是一个基于 Vue 的图编辑器前端应用，集成了 AntV G6 Editor 作为核心图形编辑引擎，结合 Element UI 提供的 UI 组件、Font Awesome 图标资源，以及 `netflix-conductor-json-tree` 实现数据结构转换。项目采用 Vue CLI 作为工程化构建工具，通过 Babel 进行语法转换，Less 处理样式，并通过 `vue.config.js` 进行构建路径配置。

项目结构清晰，主应用位于 `src/` 目录，包含视图、组件与核心逻辑；`demo/` 目录提供独立示例；`doc/` 包含开发文档与参考材料。

## 核心依赖分析

### @antv/g6-editor 图编辑引擎

`@antv/g6-editor` 是本项目的核心图编辑引擎，版本为 `^1.2.0`，负责图形的创建、编辑、布局与交互。它提供了流程图、思维导图、拓扑图等多种图编辑能力。

在 `src/views/index.vue` 中，通过 `import G6Editor from "@antv/g6-editor"` 引入，并在 `initG6Editor` 方法中实例化 `G6Editor`，并挂载多个组件：
- `G6Editor.Flow`：流程图画布
- `G6Editor.Itempannel`：元素面板
- `G6Editor.Toolbar`：工具栏
- `G6Editor.Detailpannel`：属性栏
- `G6Editor.Minimap`：缩略图
- `G6Editor.Contextmenu`：右键菜单

此外，通过 `G6Editor.Command.registerCommand("save", ...)` 注册了自定义保存命令，支持快捷键 `Ctrl+S` 或 `Cmd+S`。

**Section sources**  
- [package.json](file://package.json#L10)
- [src/views/index.vue](file://src/views/index.vue#L233-L281)

### Vue 前端框架

Vue 作为基础前端框架，版本为 `^2.6.11`，提供响应式数据绑定、组件化开发与虚拟 DOM 渲染能力。

在 `src/main.js` 中通过 `import Vue from "vue"` 引入，并创建根实例，挂载到 `#app` 容器。同时，为方便调试，将 Vue 实例挂载到 `window.blueju`。

**Section sources**  
- [package.json](file://package.json#L14)
- [src/main.js](file://src/main.js#L0-L17)

### Element UI 组件库

Element UI 版本为 `^2.13.0`，提供丰富的 UI 组件，如按钮、表单、对话框、布局栅格等，用于构建编辑器界面。

在 `src/main.js` 中通过 `import ElementUI from "element-ui"` 引入，并使用 `Vue.use(ElementUI, { size: "small" })` 全局注册，设置默认尺寸为小号。

在 `src/views/index.vue` 中广泛使用 `el-row`、`el-col`、`el-button`、`el-input`、`el-dialog`、`el-form` 等组件构建工具栏、属性栏与弹窗。

**Section sources**  
- [package.json](file://package.json#L11)
- [src/main.js](file://src/main.js#L4-L8)
- [src/views/index.vue](file://src/views/index.vue#L1-L232)

### Font Awesome 图标库

Font Awesome 版本为 `^4.7.0`，提供丰富的图标资源，用于工具栏按钮的视觉标识。

在 `src/main.js` 中通过 `import "font-awesome/css/font-awesome.min.css"` 引入样式文件。

在 `src/views/index.vue` 的工具栏中，使用 `<i class="fa fa-floppy-o">` 等方式调用图标，如保存、撤销、放大等操作。

**Section sources**  
- [package.json](file://package.json#L12)
- [src/main.js](file://src/main.js#L9-L10)
- [src/views/index.vue](file://src/views/index.vue#L1-L23)

### netflix-conductor-json-tree 数据结构转换

`netflix-conductor-json-tree` 版本为 `^0.0.4`，用于将图编辑器导出的 JSON 数据结构转换为特定格式，可能用于与 Netflix Conductor 工作流引擎集成。

在 `src/views/index.vue` 中通过 `import { construct } from "netflix-conductor-json-tree/dist/index"` 引入 `construct` 函数，并在 `save` 方法中调用，将 `editor.getCurrentPage().save()` 获取的数据进行转换。

```javascript
save(source) {
  let res = construct(source);
  console.log(JSON.stringify(res, null, 2));
}
```

**Section sources**  
- [package.json](file://package.json#L13)
- [src/views/index.vue](file://src/views/index.vue#L233-L235)

## 构建与配置

### package.json 脚本与依赖

`package.json` 定义了项目元信息、依赖与构建脚本。

**生产依赖**：
- `@antv/g6-editor`: 图编辑核心
- `vue`: 前端框架
- `element-ui`: UI 组件
- `font-awesome`: 图标
- `netflix-conductor-json-tree`: 数据转换
- `core-js`: JavaScript 标准库

**开发依赖**：
- `@vue/cli-service`: Vue CLI 核心服务
- `@vue/cli-plugin-babel`: Babel 编译支持
- `less` 与 `less-loader`: Less 样式编译
- `eslint` 相关：代码规范检查

**构建脚本**：
- `dev`: 启动开发服务器 `vue-cli-service serve`
- `build`: 生产环境构建 `vue-cli-service build`
- `build:demo`: 演示模式构建，使用 `--mode demo` 参数

**Section sources**  
- [package.json](file://package.json#L0-L29)

### babel.config.js 配置

`babel.config.js` 配置 Babel 编译器，使用 `@vue/cli-plugin-babel/preset` 预设，支持 Vue 单文件组件、ES6+ 语法转换、JSX 等特性，确保代码在目标浏览器中兼容运行。

```js
module.exports = {
  presets: [
    '@vue/cli-plugin-babel/preset'
  ]
}
```

**Section sources**  
- [babel.config.js](file://babel.config.js#L0-L4)

### vue.config.js 配置

`vue.config.js` 是 Vue CLI 的自定义配置文件，用于覆盖默认构建行为。

当前配置主要设置 `publicPath`：当环境变量 `NODE_ENV` 为 `demo` 时，静态资源路径指向 GitHub Pages 的 CDN 地址 `https://blueju.github.io/vue-g6-editor/dist/`，便于部署演示版本。

```js
module.exports = {
  publicPath: (function() {
    if (process.env.NODE_ENV === "demo") {
      return "https://blueju.github.io/vue-g6-editor/dist/";
    }
  })()
};
```

**Section sources**  
- [vue.config.js](file://vue.config.js#L0-L6)

## 样式与工程化

### Less 样式处理

项目使用 Less 作为 CSS 预处理器，通过 `less` 和 `less-loader` 在构建时编译为 CSS。

在 `src/views/index.vue` 中通过 `<style lang="less">` 声明使用 Less，并导入 `index.less` 文件。

`src/views/index.less` 定义了全局变量（如 `@backgroundColor`、`@borderColor`）、布局样式（如高度计算 `calc(100vh - ...)`）、组件样式（工具栏、元素面板、属性栏等）以及深度选择器 `/deep/` 用于穿透 scoped 样式。

**Section sources**  
- [package.json](file://package.json#L24-L25)
- [src/views/index.vue](file://src/views/index.vue#L513-L514)
- [src/views/index.less](file://src/views/index.less#L0-L146)

### Vue CLI 工具链支持

Vue CLI 提供完整的工程化支持，包括：
- 项目脚手架初始化
- 开发服务器热重载
- 生产环境代码压缩、Tree Shaking
- 静态资源处理（图片、字体）
- HTML 模板注入（`public/index.html`）
- 环境变量管理
- 插件系统（Babel、ESLint、Less 等）

项目依赖 `@vue/cli-service` 和相关插件，确保开发与构建流程自动化与标准化。

**Section sources**  
- [package.json](file://package.json#L18-L19)
- [public/index.html](file://public/index.html#L0-L16)

## 集成方式与调用位置

各依赖在项目中的集成方式如下：

| 依赖 | 引入方式 | 主要调用位置 | 功能 |
|------|----------|-------------|------|
| @antv/g6-editor | ES6 import | `src/views/index.vue` | 图形编辑核心 |
| Vue | ES6 import | `src/main.js` | 应用启动与组件化 |
| Element UI | 全局注册 | `src/main.js` + `*.vue` | UI 组件渲染 |
| Font Awesome | CSS import | `src/main.js` + `*.vue` | 图标显示 |
| netflix-conductor-json-tree | ES6 import | `src/views/index.vue` | 数据结构转换 |
| Less | lang="less" | `src/views/index.vue` | 样式编写 |
| Babel | preset 配置 | `babel.config.js` | 语法转换 |
| Vue CLI | devDependencies | `package.json` | 构建与服务 |

**Section sources**  
- [src/main.js](file://src/main.js#L0-L17)
- [src/views/index.vue](file://src/views/index.vue#L0-L514)

## 升级与定制建议

### 依赖升级建议
- **Vue 2 → Vue 3**：可考虑升级至 Vue 3 以获得更好的性能与 Composition API，但需注意 `element-ui` 不支持 Vue 3，应替换为 `element-plus`。
- **Element UI → Element Plus**：若升级 Vue 3，则必须替换为 `element-plus`。
- **G6 Editor**：关注 AntV 官方是否推出新版 `@antv/g6-editor` 或推荐迁移至 `gg-editor`（文档中提及）。
- **netflix-conductor-json-tree**：该包版本较低（0.0.4），需确认其维护状态与兼容性。

### 定制建议
- **主题定制**：通过 Less 变量统一修改颜色、尺寸等。
- **命令扩展**：参考 `save` 命令，注册自定义功能。
- **节点/边定制**：通过 `data-shape` 定义自定义图形。
- **国际化**：可结合 Vue I18n 实现多语言支持。

## 潜在风险与兼容性

### 版本冲突风险
- `element-ui` 仅支持 Vue 2，若升级 Vue 3 将导致不兼容。
- `font-awesome` 4.x 与 5.x 图标类名不兼容，升级需修改模板。
- `netflix-conductor-json-tree` 为早期版本，可能存在 API 变更或安全漏洞。

### 兼容性问题
- 项目使用 `core-js` 3.x，确保现代 JavaScript 特性在旧浏览器中运行。
- `vue.config.js` 中的 `publicPath` 逻辑需确保 `NODE_ENV` 正确设置，避免资源加载失败。
- Less 深度选择器 `/deep/` 在未来 Vue 版本中可能被废弃，建议使用 `::v-deep`。

### 维护性风险
- `g6-editor` 官方文档链接已失效，项目可能处于维护状态，建议关注 `gg-editor` 等替代方案。
- 项目依赖较多，需定期更新以修复安全漏洞。